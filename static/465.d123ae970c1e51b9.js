"use strict";(self.webpackChunktemplate=self.webpackChunktemplate||[]).push([[465],{2465:(y,c,n)=>{n.r(c),n.d(c,{MessagesModule:()=>C});var r=n(6895),o=n(433),m=n(8396),d=n(2912),e=n(4650),u=n(54),h=n(791);const p=["scrollframe"],f=["item"],v=function(t,a){return{"avatar-online":t,"avatar-away":a}};function _(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"a",31),e.NdJ("click",function(){e.CHM(s);const l=e.oxw().$implicit,g=e.oxw();return e.KtG(g.selectedUser(l))}),e.TgZ(1,"div",19)(2,"div",32),e._UZ(3,"img",6),e.qZA()(),e.TgZ(4,"div",21)(5,"div")(6,"div",22),e._uU(7),e.qZA(),e.TgZ(8,"div",33),e._uU(9,"Hey, How are you?"),e.qZA()(),e.TgZ(10,"div")(11,"div",34),e._uU(12,"2 min"),e.qZA(),e.TgZ(13,"div",35),e._uU(14,"15"),e.qZA()()()()}if(2&t){const s=e.oxw().$implicit;e.xp6(2),e.Q6J("ngClass",e.WLB(2,v,"true"===s.active,"false"===s.active)),e.xp6(5),e.hij(" ",s.firstName+" "+s.lastName,"")}}function M(t,a){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,_,15,5,"a",30),e.qZA()),2&t){const s=a.$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngIf",s._id!=i.loggedinUserID)}}function Z(t,a){if(1&t&&(e.TgZ(0,"li",40)(1,"div",21)(2,"div",41)(3,"div")(4,"p"),e._uU(5),e.qZA(),e.TgZ(6,"ul",42)(7,"li")(8,"div",43)(9,"span"),e._uU(10),e.ALo(11,"date"),e.qZA()()()()()()()()),2&t){const s=e.oxw().$implicit;e.xp6(5),e.Oqu(s.message),e.xp6(5),e.Oqu(e.xi3(11,2,s.createdAt,"shortTime"))}}function U(t,a){if(1&t&&(e.TgZ(0,"li",44)(1,"div",45),e._UZ(2,"img",46),e.qZA(),e.TgZ(3,"div",21)(4,"div",41)(5,"div")(6,"p"),e._uU(7),e.qZA(),e.TgZ(8,"ul",42)(9,"li")(10,"div",47)(11,"span"),e._uU(12),e.ALo(13,"date"),e.qZA()()()()()()()()),2&t){const s=e.oxw().$implicit;e.xp6(7),e.Oqu(s.message),e.xp6(5),e.Oqu(e.xi3(13,2,s.createdAt,"shortTime"))}}function A(t,a){if(1&t&&(e.TgZ(0,"ul",36,37),e.YNc(2,Z,12,5,"li",38),e.YNc(3,U,14,5,"li",39),e.qZA()),2&t){const s=a.$implicit,i=e.oxw();e.xp6(2),e.Q6J("ngIf",i.loggedinUserID===s.from&&i.selectedUserID===s.to),e.xp6(1),e.Q6J("ngIf",i.loggedinUserID===s.to&&i.selectedUserID===s.from)}}const T=[{path:"",component:(()=>{class t{constructor(s,i){this._messagesService=s,this._storageService=i,this.users=[],this.allMessages=[],this.latestMessage=""}ngOnInit(){this.getAllMessagedUsers()}getAllMessagedUsers(){this.loggedinUserID&&this._messagesService.getAllMessagedUsers(this.loggedinUserID).subscribe(s=>{if(s.users.length>0)if(this.users=s.users,history.state.data){let i={_id:history.state.data.userId,firstName:history.state.data.firstName,lastName:history.state.data.lastName};this.selectedUser(i)}else s.users[0]._id!=this.loggedinUserID?this.selectedUser(s.users[0]):s.users.length>1&&this.selectedUser(s.users[1])})}selectedUser(s){s&&(this.selectedUserID=s._id,this.currentUser=s.firstName+" "+s.lastName,this.getAllByFromAndTo())}get loggedinUserID(){return this._storageService.getDataFromLocalStorage("id")}send(){this._messagesService.send({from:this.loggedinUserID,to:this.selectedUserID,message:this.message}).subscribe(i=>{this.message="",this.getAllByFromAndTo()})}getAllByFromAndTo(){this._messagesService.getAllByFromAndTo({from:this.loggedinUserID,to:this.selectedUserID}).subscribe(i=>{i.results.length>0&&(this.allMessages=i.results)})}getLatestMessage(){this.latestMessage="",this.allMessages&&this.allMessages.map((s,i)=>{this.allMessages.length-1==i&&(this.latestMessage=s.message)})}ngAfterViewInit(){this.scrollContainer=this.scrollFrame.nativeElement,this.itemElements.changes.subscribe(s=>this.onItemElementsChanged())}onItemElementsChanged(){this.scrollToBottom()}scrollToBottom(){this.scrollContainer.scroll({top:this.scrollContainer.scrollHeight,left:0})}}return t.\u0275fac=function(s){return new(s||t)(e.Y36(u.K),e.Y36(h.V))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-messages"]],viewQuery:function(s,i){if(1&s&&(e.Gf(p,5),e.Gf(f,5)),2&s){let l;e.iGM(l=e.CRH())&&(i.scrollFrame=l.first),e.iGM(l=e.CRH())&&(i.itemElements=l)}},decls:40,vars:5,consts:[[1,"row"],[1,"col-xl-12"],[1,"chat-window"],[1,"chat-cont-left"],[1,"chat-search","d-flex","align-items-center"],[1,"avatar","avatar-online","me-3"],["src","assets/img/user/user.jpg","alt","User Image",1,"avatar-img","rounded-circle"],[1,"input-group"],[1,"input-group-prepend"],[1,"fas","fa-search"],["type","text","placeholder","Search",1,"form-control","rounded-pill"],[1,"chat-header"],[1,"chat-users-list"],[1,"chat-scroll"],[4,"ngFor","ngForOf"],[1,"chat-cont-right","msg-p"],["id","back_user_list","href","javascript:void(0)",1,"back-user-list"],[1,"material-icons"],[1,"media","d-flex"],[1,"media-img-wrap","flex-shrink-0"],[1,"avatar","avatar-online"],[1,"media-body","flex-grow-1"],[1,"user-name"],[1,"user-status"],[1,"chat-body"],["scrollframe",""],["class","list-unstyled",4,"ngFor","ngForOf"],[1,"chat-footer","msg-f"],["type","text","placeholder","Type something",1,"input-msg-send","form-control",3,"ngModel","ngModelChange"],["type","button",1,"btn","msg-send-btn",3,"disabled","click"],["href","javascript:void(0);","class","media d-flex",3,"click",4,"ngIf"],["href","javascript:void(0);",1,"media","d-flex",3,"click"],[1,"avatar",3,"ngClass"],[1,"user-last-chat"],[1,"last-chat-time","block"],[1,"badge","badge-primary","rounded-pill"],[1,"list-unstyled"],["item",""],["class","media sent d-flex",4,"ngIf"],["class","media received d-flex",4,"ngIf"],[1,"media","sent","d-flex"],[1,"msg-box"],[1,"chat-msg-info"],[1,"chat-time","msg-send"],[1,"media","received","d-flex"],[1,"avatar","flex-shrink-0"],["src","assets/img/user/user10.jpg","alt","User Image",1,"avatar-img","rounded-circle"],[1,"chat-time","msg-rece"]],template:function(s,i){1&s&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"form",4)(5,"div",5),e._UZ(6,"img",6),e.qZA(),e.TgZ(7,"div",7)(8,"div",8),e._UZ(9,"i",9),e.qZA(),e._UZ(10,"input",10),e.qZA()(),e.TgZ(11,"div",11)(12,"span"),e._uU(13,"Chats"),e.qZA()(),e.TgZ(14,"div",12)(15,"div",13),e.YNc(16,M,2,1,"div",14),e.qZA()()(),e.TgZ(17,"div",15)(18,"div",11)(19,"a",16)(20,"i",17),e._uU(21,"chevron_left"),e.qZA()(),e.TgZ(22,"div",18)(23,"div",19)(24,"div",20),e._UZ(25,"img",6),e.qZA()(),e.TgZ(26,"div",21)(27,"div",22),e._uU(28),e.qZA(),e.TgZ(29,"div",23),e._uU(30,"online"),e.qZA()()()(),e.TgZ(31,"div",24,25)(33,"div"),e.YNc(34,A,4,2,"ul",26),e.qZA()(),e.TgZ(35,"div",27)(36,"div",7)(37,"input",28),e.NdJ("ngModelChange",function(g){return i.message=g}),e.qZA(),e.TgZ(38,"button",29),e.NdJ("click",function(){return i.send()}),e._uU(39,"Send"),e.qZA()()()()()()()),2&s&&(e.xp6(16),e.Q6J("ngForOf",i.users),e.xp6(12),e.Oqu(i.currentUser),e.xp6(6),e.Q6J("ngForOf",i.allMessages),e.xp6(3),e.Q6J("ngModel",i.message),e.xp6(1),e.Q6J("disabled",!i.message))},dependencies:[r.mk,r.sg,r.O5,o._Y,o.Fj,o.JJ,o.JL,o.On,o.F,r.uU],styles:[".chat-window .chat-cont-right .chat-footer .input-group .btn.msg-send-btn{border-radius:6px}.msg-send[_ngcontent-%COMP%]{color:#fff!important}.msg-rece[_ngcontent-%COMP%]{color:#32414866!important}.msg-p[_ngcontent-%COMP%]{position:relative!important}.msg-f[_ngcontent-%COMP%]{width:100%!important;position:absolute!important;bottom:0!important}"]}),t})()}];let x=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[d.Bz.forChild(T),d.Bz]}),t})(),C=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[r.ez,x,o.u5,o.UX,m.U$]}),t})()}}]);